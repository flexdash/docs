
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../examples/">
      
      <link rel="icon" href="../../docs.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.2">
    
    
      
        <title>Docker - FlexDash</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.f56500e0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#docker" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="FlexDash" class="md-header__button md-logo" aria-label="FlexDash" data-md-component="logo">
      
  <img src="../../docs.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            FlexDash
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Docker
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="FlexDash" class="md-nav__button md-logo" aria-label="FlexDash" data-md-component="logo">
      
  <img src="../../docs.png" alt="logo">

    </a>
    FlexDash
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../known-issues/" class="md-nav__link">
        Known Issues
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../">Quick Start</a>
          
            <label for="__nav_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Quick Start" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Quick Start
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Docker
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Docker
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hello-world" class="md-nav__link">
    Hello World
  </a>
  
    <nav class="md-nav" aria-label="Hello World">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#explanation" class="md-nav__link">
    Explanation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#raspberry-pi" class="md-nav__link">
    Raspberry Pi
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keeping-data-and-avoiding-the-reinstall" class="md-nav__link">
    Keeping data and avoiding the reinstall
  </a>
  
    <nav class="md-nav" aria-label="Keeping data and avoiding the reinstall">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#background-on-node-red-directories" class="md-nav__link">
    Background on Node-RED directories
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-solution" class="md-nav__link">
    The solution
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-packages-using-the-palette-manager" class="md-nav__link">
    Installing packages using the palette-manager
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-source-directories" class="md-nav__link">
    Using source directories
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#faq" class="md-nav__link">
    FAQ
  </a>
  
    <nav class="md-nav" aria-label="FAQ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#i-tried-to-combine-the-npm-install-in-data-with-launching-node-red-and-it-didnt-work" class="md-nav__link">
    I tried to combine the npm install in /data with launching Node-RED and it didn't work
  </a>
  
    <nav class="md-nav" aria-label="I tried to combine the npm install in /data with launching Node-RED and it didn't work">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#answer" class="md-nav__link">
    Answer
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/" class="md-nav__link">
        Examples
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../using-flexdash/">Using FlexDash</a>
          
            <label for="__nav_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Using FlexDash" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Using FlexDash
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-flexdash/core-concepts/" class="md-nav__link">
        Core Concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-flexdash/grid-panel-layout/" class="md-nav__link">
        Grid and Panel layout
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-flexdash/iframes/" class="md-nav__link">
        IFrames
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-flexdash/edit-mode/" class="md-nav__link">
        Edit Mode
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-flexdash/nr-subflows/" class="md-nav__link">
        Node-RED Subflows
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-flexdash/array-widgets/" class="md-nav__link">
        Array Widgets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-flexdash/colors/" class="md-nav__link">
        Colors and themes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-flexdash/time-plots/" class="md-nav__link">
        Customizing Time Plots
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../developing-widgets/">Developing Widgets</a>
          
            <label for="__nav_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Developing Widgets" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Developing Widgets
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developing-widgets/quick-start/" class="md-nav__link">
        Quickly modify an existing widget
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developing-widgets/imports/" class="md-nav__link">
        Imports in custom widgets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developing-widgets/vue-primer/" class="md-nav__link">
        Vue primer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developing-widgets/vue-extensions/" class="md-nav__link">
        Extensions to Vue components
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developing-widgets/vuetify-primer/" class="md-nav__link">
        Vuetify Primer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developing-widgets/communication/" class="md-nav__link">
        Mirror state -- don't send messages
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developing-widgets/widget-config/" class="md-nav__link">
        Configuring widgets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developing-widgets/npm-start/" class="md-nav__link">
        Create an NPM package from an existing widget
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developing-widgets/node-generator/" class="md-nav__link">
        Generating nodes from widgets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developing-widgets/background/" class="md-nav__link">
        Background and Implementation Details
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hello-world" class="md-nav__link">
    Hello World
  </a>
  
    <nav class="md-nav" aria-label="Hello World">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#explanation" class="md-nav__link">
    Explanation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#raspberry-pi" class="md-nav__link">
    Raspberry Pi
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keeping-data-and-avoiding-the-reinstall" class="md-nav__link">
    Keeping data and avoiding the reinstall
  </a>
  
    <nav class="md-nav" aria-label="Keeping data and avoiding the reinstall">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#background-on-node-red-directories" class="md-nav__link">
    Background on Node-RED directories
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-solution" class="md-nav__link">
    The solution
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-packages-using-the-palette-manager" class="md-nav__link">
    Installing packages using the palette-manager
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-source-directories" class="md-nav__link">
    Using source directories
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#faq" class="md-nav__link">
    FAQ
  </a>
  
    <nav class="md-nav" aria-label="FAQ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#i-tried-to-combine-the-npm-install-in-data-with-launching-node-red-and-it-didnt-work" class="md-nav__link">
    I tried to combine the npm install in /data with launching Node-RED and it didn't work
  </a>
  
    <nav class="md-nav" aria-label="I tried to combine the npm install in /data with launching Node-RED and it didn't work">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#answer" class="md-nav__link">
    Answer
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="docker">Docker</h1>
<figure>
<p><img align="right" alt="docker logo" src="../docker.png" width="20%" /></p>
<p><em>Running Node-RED and FlexDash in Docker</em></p>
<p>In the context of Node-RED <a href="https://docker.com">Docker</a> is a virtualization layer that
cleanly separates:</p>
<ol>
<li>the Node-RED installation</li>
<li>your data on which Node-RED operates</li>
<li>the rest of the application installed on your computer</li>
</ol>
</figure>
<p>This clean separation means that:
- you can easily try a new version/feature in Node-RED without affecting the rest of your computer or your existing Node-RED data
- you can easily switch to a different version of Node-RED while keeping your data intact</p>
<p>This page assumes docker is already installed, it is available on all platforms.
The commandlines shown assume a linux shell (e.g. bash) but they work with minor
modifications, e.g. to paths, on other platforms as well.
<em>(Pull requests with Windows/Mac examples welcome!)</em></p>
<h2 id="hello-world">Hello World</h2>
<p>The following steps bring up a Node-RED instance with FlexDash installed.
You can then import one of the built-in examples to explore FlexDash.</p>
<p>Run the following command in your preferred shell (you can use the <code>\</code> at the end of every line
or concatenate everything into one long commandline):</p>
<div class="highlight"><pre><span></span><code>docker run --rm -ti -p 1990:1880 \
  --entrypoint bash \
  --name my-node-red \
  nodered/node-red:3.0.1 \
  -c &quot;npm i @flexdash/node-red-fd-corewidgets; npm start --cache /data/.npm -- -v -userDir /data&quot;
</code></pre></div>
<p>Open <a href="http://localhost:1990/">http://localhost:1990/</a> and you will see the Node-RED editor.</p>
<figure>
<p><img align="right" alt="hello-world import" src="../hello-world-dash.png" width="50%" /></p>
<p>You can now <a href="../examples/">follow the examples</a>, e.g.:
use the top-right menu and select "import", then "examples",
then "@flexdash/node-red-fd-corewidget", and pick the Hello World example.
Deploy and open <a href="http://localhost:1990/flexdash">http://localhost:1990/flexdash</a>
and you will see the dashboard.</p>
</figure>
<p>In the commandline window where you launched docker you will see the Node-RED log.</p>
<p>Once you are done, hit ctrl-C for the docker command and everything will vanish.</p>
<h3 id="explanation">Explanation</h3>
<p>The commandline above launches a docker container that first installs FlexDash and then runs
Node-RED. In more detail, the command options do the following:</p>
<ul>
<li><code>-rm</code> deletes the container after it stops</li>
<li><code>-ti</code> keeps the container running in the foreground so you can see the Node-RED log and
  you can hit Ctrl-C to terminate.</li>
<li><code>-p 1990:1880</code> maps the host's TCP port 1990 to the container's port 1880, which is the port on
  which Node-RED starts its web server. You can map 1880 to 1880 (<code>-p 1880:1880</code>), the example
  above uses a different port in order not to conflict with a regular Node-RED you may
  already have running. As you might guess, you can run multiple Node-RED containers
  simultaneously to try out different things as long as you choose a different port and a
  different container name for each one.</li>
<li><code>--entrypoint bash</code> runs a shell instead of directly launching Node-RED, which is what
  the Node-RED image does by default</li>
<li><code>-name my-node-red</code> gives the container a name which is helpful if you look at
  running containers (<code>docker ps</code>) or you want a shell in the container
  (<code>docker exec -ti my-node-red bash</code>)</li>
<li><code>nodered/node-red:3.0.1</code> is the image to download and run, pick a more recent version
  of Node-RED if there is one.</li>
<li><code>-c ...</code> is the command the shell is to execute, <code>npm i @flexdash/node-red-fd-corewidgets</code>
  installs the core widgets and brings node-red-flexdash in as a dependency, and
  <code>npm start ...</code> starts Node-RED</li>
</ul>
<p>This method of launching Node-RED is great for quickly trying something out from a clean slate.
It takes a few seconds to start up and everything is gone at the end.</p>
<h2 id="raspberry-pi">Raspberry Pi</h2>
<div class="admonition todo">
<p class="admonition-title">Todo</p>
<p>Test running this on rPi</p>
</div>
<h2 id="keeping-data-and-avoiding-the-reinstall">Keeping data and avoiding the reinstall</h2>
<p>The above command launches a truly throw-away container: once it terminates there's
nothing left. For a more persistent set-up where you can relaunch the container yet
keep your flows and other data, such as file-based context stores, you need to provide
a "data" directory to store all this independently of whether a container is running or
not. Conveniently, the FlexDash modules can be installed in the data directory so they are
persisted too and don't need to be reinstalled every time the container is launched.</p>
<h3 id="background-on-node-red-directories">Background on Node-RED directories</h3>
<p>Before laying out a solution it's worth understanding what can go where and how, because
once that's understood the action plan becomes trivial and it becomes easy to tweak things
slightly for different purposes.</p>
<p>Node-RED primarily uses two directories: its home directory (or working directory) and
its data directory. When running under docker these are <code>/usr/src/node-red</code> and <code>/data</code>, respectively.
Node-RED itself is installed in the home dir, which may be read-only,
and it places all user data in <code>/data</code>, which is assumed to be writable.</p>
<p>Node.js, the programming framework used by Node-RED, expects code to be installed in a
<code>node_modules</code> subdirectory. For example, Node-RED is actually found within
<code>/usr/src/node-red/node_modules</code>. Because Node-RED assumes that its home dir may be read-only
and it needs to be able to install additional packages it uses <em>two</em> <code>node_modules</code>
directories: the one in its home directory and also <code>/data/node_modules</code>.</p>
<p>Finally, to install a package, change directory to the one <em>above</em> <code>node_modules</code> and
run <code>npm install &lt;package&gt;</code>.</p>
<h3 id="the-solution">The solution</h3>
<p>We want our data to persist, so we mount a host directory onto <code>/data</code>, this way when something gets
written there it really is in that host directory.
We also want the packages we install to persist, so we install them into <code>/data/node_modules</code>.
We then want to repeatedly launch the Node-RED container using the persisted data and persisted
module installation.</p>
<p>To achieve this two different container runs will be necessary. The first one will install
the desired packages and subsequent runs will just run Node-RED.
For the first run, create a data directory to store the persistent data,
for example <code>./node-red-data</code>. Then launch a container as follows:</p>
<div class="highlight"><pre><span></span><code>docker run --rm -ti \
  -v $PWD/node-red-data:/data \
  --entrypoint bash \
  nodered/node-red:3.0.1 \
  -c &quot;cd /data; npm i @flexdash/node-red-fd-corewidgets&quot;
</code></pre></div>
<p>The only new options compared to the incantation at the top of this page is the -v:</p>
<ul>
<li><code>-v $PWD/node-red-data:/data</code> mounts the node-red-data subdirectory onto <code>/data</code> within
  the container, i.e., any access to files under <code>/data</code> in the container will be rerouted
  to <code>node-red-data</code> on the host. The paths must be absolute, so under unix <code>$PWD</code> will expand
  to the current working directory. You can also just type out <code>/home/me/somedir/node-red-data</code> or
  under Windows <code>C:\Users\me\node-red-data</code> (the part after the colon remains <code>/data</code> since that's
  the path inside the container).</li>
</ul>
<p>This container will run for a few seconds and then exit. You will see the NPM install progress
and also spit out some warnings, in particular "saveError ENOENT: no such file or directory,
open '/data/package.json'". These warnings are due to the fact that we're installing into an
empty directory, which is a bit of an odd usage.</p>
<p>What this accomplishes is to install the chosen packages (here node-red-fd-corewidgets and its dependencies) using the version of npm installed in the container, which is the one Node-RED
will also use.</p>
<p>Now comes the second step, which is to actually launch Node-RED:</p>
<div class="highlight"><pre><span></span><code>docker run --rm -ti -p 1990:1880 \
  -v $PWD/node-red-data:/data \
  --name flexdash-demo \
  nodered/node-red:3.0.1
</code></pre></div>
<p>This second incantation is quite simple: it just mounts the persisted data directory onto
<code>/data</code> and starts Node-RED the standard way (plus gives the container a name so a
<code>docker ls</code> shows something recognizable).</p>
<ul>
<li>To stop the container, hit Ctrl-C. It can be restarted anytime in the same manner.</li>
<li>To install additional packages, stop the Node-RED container, run the first incatation with
  a modified npm commandline, then start the Node-RED container again.</li>
<li>To try a different version of Node-RED, just alter the <code>3.0.1</code> part and as long as the
  versions are compatible, it should work.</li>
<li>To start from scratch, delete the <code>node-red-data</code> directory and start over.</li>
</ul>
<h3 id="installing-packages-using-the-palette-manager">Installing packages using the palette-manager</h3>
<p>Node-RED includes the ability to install packages from its web interface,
specifically using the palette manager found in the top-right menu.
The install tab allows to search for packages and a small install button installs
them in the <code>data</code> directory just like the <code>npm install</code> command used above.</p>
<p>In principle, this means that the first docker run above could be skipped, going straight to the
second one, and then simply using the palette manager to install <code>node-red-fd-corewidgets</code>.</p>
<p>Unfortunately, as of version 3.0.1 there is a bug, which is that the nodes found in
dependencies are not installed. What this means is that if one installs
<code>node-red-fd-corewidgets</code> then <code>node-red-flexdash</code> and <code>node-red-flexdash-plugins</code>
are also installed, but the configuration nodes these two packages contain are not loaded
resulting in a non-functional situation.</p>
<p>There are two work-arounds:
1. Explicitly install the dependencies: search for flexdash in the install tab and install
   all three packages listed above.
2. Install just the corewidgets package, then stop the container and restart it: Node-RED
   will then pick-up the config nodes from the dependencies.</p>
<h3 id="using-source-directories">Using source directories</h3>
<p>There is one more tweak that is helpful when developing a new package, e.g. some new FlexDash widgets.
In that case one needs Node-RED to use the package being developed from its source directory
on the host.
The assumed directory layout here is a <code>node-red-data</code> subdirectory for <code>/data</code> and a
<code>node-red-fd-mywidgets</code> subdirectory with the new nodes and widgets.</p>
<p>The first incantation to install the source package is very similar to the one above.
The two twists are to map the source directory into the container (previously the packages
came from the internet) and to perform a "link install", which creates a symbolic link in
<code>node_modules</code> to the source directory (within the container, can't link to something outside).</p>
<div class="highlight"><pre><span></span><code>docker run --rm -ti \
  -v $PWD/node-red-data:/data \
  -v $PWD/node-red-fd-mywidgets:/data/node-red-fd-mywidgets \
  --entrypoint bash \
  nodered/node-red:3.0.1 \
  -c &quot;cd /data; npm i ./node-red-fd-mywidgets&quot;
</code></pre></div>
<p>On the host, looking at <code>node-red-data/node_modules</code> should show a symbolic link
<code>node-red-fd-mywidgets</code> -&gt; <code>../node-red-fd-mywidgets</code>. (If the <code>packages.json</code> has a
<code>name</code> entry with a namespace then it will be a bit different. I named my
package <code>@tve/node-red-fd-mywidgets</code> and thus ended up with
<code>node-red-data/node_modules/@tve/node-red-fd-mywidgets</code> -&gt; <code>../../node-red-fd-mywidgets</code>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>package.json</code> in <code>node-red-fd-mywidgets</code> needs to have its dependencies right,
specifically, it needs to depend on <code>node-red-flexdash</code> so the latter gets installed
automatically!</p>
</div>
<p>After this set-up (which could map multiple source package directories, btw) the Node-RED launch
is a matter of mounting the appropriate source directories (and the data dir):</p>
<div class="highlight"><pre><span></span><code>docker run --rm -ti -p 1990:1880 \
  -v $PWD/node-red-data:/data \
  -v $PWD/node-red-fd-mywidgets:/data/node-red-fd-mywidgets \
  --name flexdash-demo \
  nodered/node-red:3.0.1
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When Node-RED is launched there is no npm install happening. Everything works assuming
no dependencies have changed because of the symbolic link. If the dependencies in the
source package's <code>package.json</code> are altered, then a re-run of the first incatation with
<code>npm i</code> is required.</p>
</div>
<h2 id="summary">Summary</h2>
<p>In the end, what the docker containers provide are:
- a pre-packaged self-contained installation of Node-RED
- an isolated filesystem namespace (directory tree) so arbitrary files on the host cannot be affected
- a controlled way to map host directories into the container's namespace</p>
<p>all the docker incantations described on this page basically map host directories into the
container filesystem tree, run some <code>npm install</code> to install desired packages, and
then run Node-RED.
Hopefully the explanations allow you to customize and tweak docker to suit your needs!</p>
<h2 id="faq">FAQ</h2>
<h3 id="i-tried-to-combine-the-npm-install-in-data-with-launching-node-red-and-it-didnt-work">I tried to combine the npm install in /data with launching Node-RED and it didn't work</h3>
<p>The command tried is:</p>
<div class="highlight"><pre><span></span><code>docker run --rm -ti -p 1990:1880 \
  -v C:\temp\fd_nr_data:/data \
  -v C:\Users\Me\node-red-fd-test:/data/node-red-fd-test \
  --entrypoint bash \
  --name my-node-red \
  nodered/node-red:3.0.1 \
  -c &quot;cd /data; npm i ./node-red-fd-test; npm start --cache /data/.npm -- -v -userDir /data&quot;
</code></pre></div>
<p>Which produced this output:</p>
<div class="highlight"><pre><span></span><code>[...]

+ ./node-red-fd-test@0.1.0
added 105 packages from 129 contributors and audited 105 packages in 9.408s

[...]

npm ERR! enoent ENOENT: no such file or directory, open &#39;/data/package.json&#39;
</code></pre></div>
<h4 id="answer">Answer</h4>
<p>You can see that the npm install worked 'cause npm prints "updated 1 package".</p>
<p>However, the <code>-c</code> commandline first performs <code>cd /data</code>, then <code>npm install</code>, and then tries to start
Node-RED using an npm command. The latter looks up what "start" means in <code>package.json</code>, which isn't
there in <code>/data</code>, and that produces an error.</p>
<p>The <code>package.json</code> to start node-red is in <code>/usr/src/node-red</code> so one has to <code>npm start</code> there
(it's the "working directory" of the container, so the bash shell starts there, that's why it works
if there is no cd command).</p>
<p>It is suggested to keep the install and the running separated in two container invocations.
To join them one has to cd back before the npm start.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.sections", "navigation.indexes"], "search": "../../assets/javascripts/workers/search.12658920.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5cf534bf.min.js"></script>
      
    
  </body>
</html>